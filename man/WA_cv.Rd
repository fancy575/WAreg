% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{WA_cv}
\alias{WA_cv}
\title{K-fold cross-validation for WA configuration selection}
\usage{
WA_cv(
  formula,
  data,
  id,
  cluster = NULL,
  basis_set = c("il", "pl", "bz"),
  degree_vec = 1:2,
  n_int_vec = c(0, 2, 4),
  knot_scheme = c("equidist", "quantile"),
  link_set = c("log"),
  time_range = NULL,
  tau_grid = NULL,
  w_recur,
  w_term,
  ipcw = c("cox", "km"),
  ipcw_formula = ~1,
  K = 5,
  seed = 1L,
  verbose = TRUE
)
}
\arguments{
\item{formula, }{data, id, cluster See \code{\link{WA_fit}}.}

\item{basis_set}{Character vector of candidate bases.}

\item{degree_vec}{Integer vector of candidate degrees.}

\item{n_int_vec}{Integer vector of interior-knot counts; 0 means boundaries only.}

\item{knot_scheme}{\code{"equidist"} or \code{"quantile"} to construct interior knots.}

\item{link_set}{Character vector of candidate links (subset of \code{c("log","identity")}).}

\item{time_range}{Optional numeric length-2 vector \code{c(tmin, tmax)}. If \code{NULL},
inferred from \code{data}.}

\item{tau_grid}{Optional numeric vector; if \code{NULL}, a default dense grid over
\code{time_range} is created.}

\item{w_recur, }{w_term Event-type weights (see \code{\link{WA_fit}}).}

\item{ipcw}{IPCW method (\code{"cox"} or \code{"km"}) for PE computation.}

\item{ipcw_formula}{One-sided RHS formula for IPCW Cox model (if \code{ipcw="cox"}).}

\item{K}{Number of folds.}

\item{seed}{RNG seed for fold assignment.}

\item{verbose}{Logical; show a text progress bar and per-fold messages.}
}
\value{
A data frame with columns: \code{basis}, \code{degree}, \code{n_int},
\code{link}, and aggregated \code{PE}. Lower \code{PE} is better.
}
\description{
Runs K-fold CV over a grid of basis types, degrees, interior-knot counts,
and link functions. For each configuration, fits the model on K-1 folds and
accumulates the prediction error (PE) on the held-out fold using
\code{WA_PE()} (IPCW computed on the training subjects).
}
\examples{
\dontrun{
tmin <- 0
tmax <- max(crt_dt$time, na.rm = TRUE)
cv_tab <- WA_cv(
  Surv(time, status) ~ intv + demo_sex_male + numchron,
  data = crt_dt, id = "screenid", cluster = "practiceid",
  basis_set = "bz", degree_vec = c(1,2,3,4),
  n_int_vec = c(0,2,3,4,5),
  knot_scheme = "equidist",
  link_set = "log",
  time_range = c(tmin, tmax),
  tau_grid = seq(0, 3.5, length.out = 6),
  w_recur = c(1), w_term = 2,
  ipcw = "cox", ipcw_formula = ~ demo_sex_male + numchron,
  K = 5, seed = 2025
)
head(cv_tab[order(cv_tab$PE), ], 10)
}
}
