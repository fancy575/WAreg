% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/WA_fit.R
\name{WA_fit}
\alias{WA_fit}
\title{Fit Weighted Composite Endpoint Model with While-Alive Frequency Measures}
\usage{
WA_fit(
  model,
  data,
  cluster = NULL,
  id,
  wr,
  wd,
  link = "log",
  cens_mod,
  sp_knots,
  degree = 1,
  cv = F,
  K = 10,
  tr = c(5, 35),
  nk = 2:6,
  ts = seq(0.001, 40, length = 1000)
)
}
\arguments{
\item{model}{A survival formula, e.g., \code{Surv(time, type) ~ Z1 + Z2}.}

\item{data}{A data frame containing the necessary columns for analysis.}

\item{cluster}{Optional string. Name of the column indicating cluster ID (for cluster-randomized trials), if NULL, it indicates independent data.}

\item{id}{A string. Name of the column indicating subject ID.}

\item{wr}{A numeric vector of weights for recurrent event types (excluding terminal event).}

\item{wd}{A single numeric value. Weight for terminal event.}

\item{link}{A link function for the while-alive loss rate ,could be "log","identity" (default is \code{"log"})}

\item{cens_mod}{A survival model formula for the censoring distribution (e.g., \code{Surv(time, delta) ~ Z1}).}

\item{sp_knots}{A numeric vector specifying the internal knots for spline basis (e.g., \code{c(5, 10, 15)}).}

\item{degree}{A non-negative integer specifying the spline polynomial degree (default is 1).}

\item{cv}{Logical. Whether to perform cross-validation to select number of knots (default is \code{FALSE}).}

\item{K}{Integer. Number of folds for cross-validation (default is 10).}

\item{tr}{A numeric vector of length 2 giving the time range for cross-validation (\code{c(start, end)}).}

\item{nk}{Integer vector. Candidate numbers of knots to consider during cross-validation (default is \code{2:6}).}

\item{ts}{A numeric vector of time points at which to evaluate treatment/covariate effects (default is \code{seq(0.001, 40, length = 1000)}).}
}
\value{
A list with class \code{"WA_obj"} containing:
\describe{
  \item{model}{Original model formula.}
  \item{cens_model}{Censoring model formula.}
  \item{degree}{Spline degree used.}
  \item{sp_knots}{Spline knot locations used.}
  \item{cov_vars}{Covariate names extracted from model.}
  \item{WA_out}{A list containing estimated coefficients, covariance matrix, and influence function.}
  \item{results_df}{A data frame of estimated time-varying effects and confidence intervals.}
  \item{call}{The original function call.}
}
}
\description{
This function fits a regression model for weighted composite endpoints using
while-alive cumulative frequency measures. It supports both individual- and
cluster-randomized trial settings and accommodates time-varying effects via splines.
Optionally performs cross-validation to select optimal spline complexity.
}
\examples{
\dontrun{
data(ex_dt)
fit <- WA_fit(Surv(time, type) ~ Z1 + Z2, data = ex_dt,
              id = "Subject", cluster = "Cluster",
              wr = c(1, 1), wd = 1,
              cens_mod = Surv(time, delta) ~ Z2,
              sp_knots = c(5, 10, 15, 20, 25, 30),
              degree = 1)
summary(fit)
plot(fit, ts = seq(0, 40, by = 1))
}

}
